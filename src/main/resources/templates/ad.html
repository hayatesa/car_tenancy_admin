<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>广告管理</title>
    <link rel="stylesheet" href="/statics/fonts/font-awesome-4.7.0/css/font-awesome.css">
    <link rel="stylesheet" href="/statics/layui-v2.4.3/css/layui.css">
</head>
<body style="padding: 10px;">

<fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
    <legend>广告表</legend>
</fieldset>
<div class="demoTable" style="display: flex;justify-content: flex-end;align-items: center">
    关键字：
    <div class="layui-inline">
        <input class="layui-input" id="demoReload" autocomplete="off" name="search">
    </div>
    <button class="layui-btn" data-type="reload" id="search">搜索</button>
</div>
<table class="layui-hide" id="tableDemo" lay-filter="tableDemo"></table>

<script type="text/html" id="toolbarDemo">
    <div class="layui-btn-container">
        <button class="layui-btn layui-btn-sm" lay-event="add">添加</button>
    </div>
</script>
<script type="text/html" id="barDemo">
    <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del" id="del">删除</a>
</script>

<script src="/statics/js/jquery-3.3.1.min.js"></script>
<script src="/statics/layui-v2.4.3/layui.all.js"></script>
<script src="/statics/vue-2.5.17/vue.min.js"></script>
<script src="/statics/js/common/common.js"></script>
<script src="/statics/js/tenancy/timeConvert.js"></script>
<script>
    layui.use('table', function(){
        var table = layui.table;
        var click = "";
        table.render({
            elem: '#tableDemo'
            ,url:'/api/Ads/all'
            ,toolbar: '#toolbarDemo'
            ,title: '广告表'
            ,cols: [
                [{field:'title', title:'标题', fixed: 'left', unresize: true, totalRowText: '合计'}
                    ,{field:'url', title:'跳转链接'}
                    ,{field:'imagePath', title:'图片路径'}
                    ,{field:'type', title:'类型', totalRow: true,templet:function(d){
                        if(d.type==0)
                            return "轮播图";
                        else
                            return "其它"
                    }}
                    ,{field:'gmtCreate', title:'创建时间', sort: true, templet:function(d){
                        var time = new Date(d.gmtCreate);
                        var times=time.getFullYear() + '-' + (time.getMonth() + 1) + '-' + time.getDate() + ' ' + time.getHours() + ':' + time.getMinutes() + ':' + time.getSeconds();
                        return times;
                    }}
                    ,{field:'gmtModified', title:'修改时间', sort: true, templet:function(d){
                        var time = new Date(d.gmtModified);
                        var times=time.getFullYear() + '-' + (time.getMonth() + 1) + '-' + time.getDate() + ' ' + time.getHours() + ':' + time.getMinutes() + ':' + time.getSeconds();
                        return times;
                    }}
                    ,{fixed: 'right', title:'操作', toolbar: '#barDemo'}]
            ]
            ,page: true
        });


        table.on('toolbar(tableDemo)', function(obj){
            if(obj.event=='add'){
                changeBtn("添加");
                showForm(click,obj.data);
            }
        });
        table.on('tool(tableDemo)', function(obj){
            if(obj.event=='edit'){
                changeBtn("保存");
                showForm(click,obj.data);
            }
            if(obj.event == 'del'){
                del(obj.data.id);
            }
        });
        $('#search').on('click',function(){
            var search = $('#demoReload').val();
            table.reload('tableDemo', {
                url: '/api/Ads/all',
                where: {
                    search:search
                }
            });
        })
    });
    function del(id){
        $.ajax({
            type:'get',
            url:'/api/Ads/del',
            data: {
                id:id
            },
            success:function (result) {
                window.location.reload();
            },
            error:function(msg){

            }
        })
    }
    function changeBtn(value){
        click = value;
    }
    function showForm(item,record){
        if(record!=null) {
            var id = record.id;
            var title = record.title;
            var url = record.url;
            var image_path = record.imagePath;
            var type = record.type;
        }else{
            var id = '';
            var title = '';
            var url = '';
            var image_path = '';
            var type = '';
        }
        layer.open({
            type: 2
            ,title: item
            ,area: ['630px', '350px']
            ,shade: 0
            ,resize:false
            ,id:1
            ,isOutAnim: false
            ,shade: [0.8, '#393D49']
            ,offset: ['10px', '281px']
            ,content: 'model.html?title='+title+'&url='+url+'&image_path='+image_path+'&type='+type+'&id='+id
            ,zIndex: layer.zIndex
            ,success: function(layero){
                layer.setTop(layero);
            }
        });
    }
</script>
</body>
</html>
